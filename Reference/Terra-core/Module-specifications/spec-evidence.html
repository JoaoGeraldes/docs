<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Evidence | Terra Docs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" type="text/css" href="https://cloud.typography.com/7420256/6416592/css/fonts.css">
    <link rel="stylesheet" type="text/css" href="https://www.terra.money/static/fonts/jetbrainsMono.css?updated=190220">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:400,500,700&amp;display=swap">
    <link rel="icon" type="image/png" href="/img/favicon.png">
    <script>window.onload = function() {
        requestAnimationFrame(function() {
          if (location.hash) {
            const element = document.getElementById(location.hash.slice(1))

            if (element) {
              element.scrollIntoView()
            }
          }
        })
      }</script>
    <meta name="description" content="Terra is an open source, public blockchain protocol that provides fundamental infrastructure for a decentralized economy and enables open participation in the creation of new financial primitives to power the innovation of money.">
    
    <link rel="preload" href="/assets/css/0.styles.b90d9300.css" as="style"><link rel="preload" href="/assets/js/app.5daa07b7.js" as="script"><link rel="preload" href="/assets/js/3.bd3f871b.js" as="script"><link rel="preload" href="/assets/js/47.2afae3bf.js" as="script"><link rel="prefetch" href="/assets/js/10.702f2eeb.js"><link rel="prefetch" href="/assets/js/11.d83e4c08.js"><link rel="prefetch" href="/assets/js/12.30fd6fcf.js"><link rel="prefetch" href="/assets/js/13.463c7cf2.js"><link rel="prefetch" href="/assets/js/14.7443f057.js"><link rel="prefetch" href="/assets/js/15.cc2ff474.js"><link rel="prefetch" href="/assets/js/16.b7303649.js"><link rel="prefetch" href="/assets/js/17.7ff360e0.js"><link rel="prefetch" href="/assets/js/18.3c97efdf.js"><link rel="prefetch" href="/assets/js/19.767c628a.js"><link rel="prefetch" href="/assets/js/20.c3b67c7e.js"><link rel="prefetch" href="/assets/js/21.ed81322c.js"><link rel="prefetch" href="/assets/js/22.d813ec61.js"><link rel="prefetch" href="/assets/js/23.6be4c4be.js"><link rel="prefetch" href="/assets/js/24.214d78e4.js"><link rel="prefetch" href="/assets/js/25.d1efda93.js"><link rel="prefetch" href="/assets/js/26.23be4177.js"><link rel="prefetch" href="/assets/js/27.65a41319.js"><link rel="prefetch" href="/assets/js/28.ed5c3ce8.js"><link rel="prefetch" href="/assets/js/29.fb35e146.js"><link rel="prefetch" href="/assets/js/30.3ccea319.js"><link rel="prefetch" href="/assets/js/31.4ca0a94d.js"><link rel="prefetch" href="/assets/js/32.1397be91.js"><link rel="prefetch" href="/assets/js/33.07cebc57.js"><link rel="prefetch" href="/assets/js/34.ced6c4b7.js"><link rel="prefetch" href="/assets/js/35.02953aa8.js"><link rel="prefetch" href="/assets/js/36.511aafec.js"><link rel="prefetch" href="/assets/js/37.fdee8eb1.js"><link rel="prefetch" href="/assets/js/38.b02aefb5.js"><link rel="prefetch" href="/assets/js/39.e3b0f4ad.js"><link rel="prefetch" href="/assets/js/4.8e884616.js"><link rel="prefetch" href="/assets/js/40.f5f6e6e2.js"><link rel="prefetch" href="/assets/js/41.e385cd8c.js"><link rel="prefetch" href="/assets/js/42.0795be7c.js"><link rel="prefetch" href="/assets/js/43.03b58b2c.js"><link rel="prefetch" href="/assets/js/44.ba137eea.js"><link rel="prefetch" href="/assets/js/45.61537e5c.js"><link rel="prefetch" href="/assets/js/46.dfc54f76.js"><link rel="prefetch" href="/assets/js/48.600d34d0.js"><link rel="prefetch" href="/assets/js/49.6a785721.js"><link rel="prefetch" href="/assets/js/5.cfa43d54.js"><link rel="prefetch" href="/assets/js/50.cc21253f.js"><link rel="prefetch" href="/assets/js/51.03862bbb.js"><link rel="prefetch" href="/assets/js/52.b6ed118d.js"><link rel="prefetch" href="/assets/js/53.9974fba3.js"><link rel="prefetch" href="/assets/js/54.52c2475b.js"><link rel="prefetch" href="/assets/js/55.805a376a.js"><link rel="prefetch" href="/assets/js/56.50135bed.js"><link rel="prefetch" href="/assets/js/57.af392382.js"><link rel="prefetch" href="/assets/js/58.0ed5c001.js"><link rel="prefetch" href="/assets/js/59.d985eb4d.js"><link rel="prefetch" href="/assets/js/6.853fdd43.js"><link rel="prefetch" href="/assets/js/60.fc6822e4.js"><link rel="prefetch" href="/assets/js/61.65d0c9ad.js"><link rel="prefetch" href="/assets/js/62.8d356e47.js"><link rel="prefetch" href="/assets/js/63.93ea2dd9.js"><link rel="prefetch" href="/assets/js/64.c399be85.js"><link rel="prefetch" href="/assets/js/65.1ce26d20.js"><link rel="prefetch" href="/assets/js/66.caa689fd.js"><link rel="prefetch" href="/assets/js/67.07a60e0f.js"><link rel="prefetch" href="/assets/js/68.2ab299b4.js"><link rel="prefetch" href="/assets/js/69.e3b97a46.js"><link rel="prefetch" href="/assets/js/7.0a026085.js"><link rel="prefetch" href="/assets/js/70.1de1c1e9.js"><link rel="prefetch" href="/assets/js/71.a837a9b4.js"><link rel="prefetch" href="/assets/js/72.ad9e6958.js"><link rel="prefetch" href="/assets/js/73.e5f402df.js"><link rel="prefetch" href="/assets/js/74.f4a9a475.js"><link rel="prefetch" href="/assets/js/75.a22d689c.js"><link rel="prefetch" href="/assets/js/76.2a314a8b.js"><link rel="prefetch" href="/assets/js/77.dbcaf9c0.js"><link rel="prefetch" href="/assets/js/78.4d0ab581.js"><link rel="prefetch" href="/assets/js/79.f99146bb.js"><link rel="prefetch" href="/assets/js/8.087c7e3b.js"><link rel="prefetch" href="/assets/js/80.c61f507f.js"><link rel="prefetch" href="/assets/js/81.bc47d9cf.js"><link rel="prefetch" href="/assets/js/82.ca602b8e.js"><link rel="prefetch" href="/assets/js/83.a0de260d.js"><link rel="prefetch" href="/assets/js/84.865f2a5b.js"><link rel="prefetch" href="/assets/js/85.6ce94127.js"><link rel="prefetch" href="/assets/js/86.fbb52d1c.js"><link rel="prefetch" href="/assets/js/87.bc68c044.js"><link rel="prefetch" href="/assets/js/88.558000c2.js"><link rel="prefetch" href="/assets/js/89.d3d1cc42.js"><link rel="prefetch" href="/assets/js/9.5c8389f5.js"><link rel="prefetch" href="/assets/js/90.56dcd92d.js"><link rel="prefetch" href="/assets/js/91.279946a8.js"><link rel="prefetch" href="/assets/js/92.7aae198a.js"><link rel="prefetch" href="/assets/js/93.884328a7.js"><link rel="prefetch" href="/assets/js/94.abfbf92f.js"><link rel="prefetch" href="/assets/js/95.3f6a6eb3.js"><link rel="prefetch" href="/assets/js/96.4609ac8b.js"><link rel="prefetch" href="/assets/js/97.6228f4cb.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.1b3c7a9c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b90d9300.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"></div> <a href="/" class="home-link router-link-active"><img src="/img/docs_logo.svg" alt="Terra Docs" class="logo"> <span class="site-name can-hide">Terra Docs</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Overview</a></div><div class="nav-item"><a href="/Tutorials/" class="nav-link">Tutorials</a></div><div class="nav-item"><a href="/How-to/" class="nav-link">How to</a></div><div class="nav-item"><a href="/Concepts/" class="nav-link">Concepts</a></div><div class="nav-item"><a href="/Reference/" class="nav-link router-link-active">Reference</a></div><div class="nav-item"><a href="/SDKs/" class="nav-link">SDKs</a></div><div class="nav-item"><a href="https://github.com/terra-money/core" target="_blank" rel="noopener noreferrer" class="nav-link external"><div class="nav-icon"><img src="/img/github.svg"></div></a></div></nav> <form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form></div></header> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Overview</a></div><div class="nav-item"><a href="/Tutorials/" class="nav-link">Tutorials</a></div><div class="nav-item"><a href="/How-to/" class="nav-link">How to</a></div><div class="nav-item"><a href="/Concepts/" class="nav-link">Concepts</a></div><div class="nav-item"><a href="/Reference/" class="nav-link router-link-active">Reference</a></div><div class="nav-item"><a href="/SDKs/" class="nav-link">SDKs</a></div><div class="nav-item"><a href="https://github.com/terra-money/core" target="_blank" rel="noopener noreferrer" class="nav-link external"><div class="nav-icon"><img src="/img/github.svg"></div></a></div></nav>  <ul class="sidebar-links"><li><a href="/Reference/" aria-current="page" class="sidebar-link">Reference</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Terra core</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Reference/Terra-core/Overview.html" class="sidebar-link">Developer guide</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-auth.html" class="sidebar-link">Auth</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-authz.html" class="sidebar-link">AuthZ</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-bank.html" class="sidebar-link">Bank</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-capability.html" class="sidebar-link">Capability</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-distribution.html" class="sidebar-link">Distribution</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-evidence.html" aria-current="page" class="active sidebar-link">Evidence</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Reference/Terra-core/Module-specifications/spec-evidence.html#concepts" class="sidebar-link">Concepts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Reference/Terra-core/Module-specifications/spec-evidence.html#evidence-2" class="sidebar-link">Evidence</a></li><li class="sidebar-sub-header"><a href="/Reference/Terra-core/Module-specifications/spec-evidence.html#registration-and-handling" class="sidebar-link">Registration and handling</a></li><li class="sidebar-sub-header"><a href="/Reference/Terra-core/Module-specifications/spec-evidence.html#state" class="sidebar-link">State</a></li></ul></li><li class="sidebar-sub-header"><a href="/Reference/Terra-core/Module-specifications/spec-evidence.html#messages" class="sidebar-link">Messages</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Reference/Terra-core/Module-specifications/spec-evidence.html#msgsubmitevidence" class="sidebar-link">MsgSubmitEvidence</a></li><li class="sidebar-sub-header"><a href="/Reference/Terra-core/Module-specifications/spec-evidence.html#events" class="sidebar-link">Events</a></li><li class="sidebar-sub-header"><a href="/Reference/Terra-core/Module-specifications/spec-evidence.html#beginblock" class="sidebar-link">BeginBlock</a></li></ul></li></ul></li><li><a href="/Reference/Terra-core/Module-specifications/spec-feegrant.html" class="sidebar-link">Fee grant</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-governance.html" class="sidebar-link">Governance</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-market.html" class="sidebar-link">Market</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-mint.html" class="sidebar-link">Mint</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-oracle.html" class="sidebar-link">Oracle</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-slashing.html" class="sidebar-link">Slashing</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-staking.html" class="sidebar-link">Staking</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-treasury.html" class="sidebar-link">Treasury</a></li><li><a href="/Reference/Terra-core/Module-specifications/spec-wasm.html" class="sidebar-link">WASM</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>terrad</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/Reference/integrations.html" class="sidebar-link">Integrations</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ecosystem</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/Reference/endpoints.html" class="sidebar-link">RPC endpoints</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Other resources</span> <span class="arrow right"></span></p> <!----></section></li></ul>  <div class="sidebar_footer"></div></aside> <main class="page"> <nav id="breadcrumb" class="breadcrumb-container" data-v-7ebed944><a href="/" class="breadcrumb router-link-active" data-v-7ebed944><span data-v-7ebed944>Terra Docs</span></a><a href="/Reference/" class="breadcrumb router-link-active" data-v-7ebed944><span data-v-7ebed944>Reference</span></a><a href="/Reference/Terra-core/Module-specifications/spec-evidence.html" aria-current="page" class="breadcrumb router-link-exact-active router-link-active" data-v-7ebed944><span data-v-7ebed944>Evidence</span></a></nav> <div class="theme-default-content content__default"><h1 id="evidence"><a href="#evidence" class="header-anchor">#</a> Evidence</h1> <div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>Terra's evidence module inherits from Cosmos SDK's <a href="https://docs.cosmos.network/master/modules/evidence/" target="_blank" rel="noopener noreferrer"><code>evidence</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> module. This document is a stub, and covers mainly important Terra-specific notes about how it is used.</p></div> <p>The evidence module allows arbitrary evidence of misbehavior, such as equivocation and counterfactual signing, to be submitted and handled.</p> <p>Typically, standard evidence handling expects the underlying consensus engine, Tendermint, to automatically submit evidence when it is discovered by allowing clients and foreign chains to submit more complex evidence directly. The evidence module operates differently.</p> <p>All concrete evidence types must implement the <code>Evidence</code> interface contract. First, submitted <code>Evidence</code> is routed through the evidence module's <code>Router</code>, where it attempts to find a corresponding registered <code>Handler</code> for that specific <code>Evidence</code> type. Each <code>Evidence</code> type must have a <code>Handler</code> registered with the evidence module's keeper for it to be successfully routed and executed.</p> <p>Each corresponding handler must also fulfill the <code>Handler</code> interface contract. The <code>Handler</code> for a given <code>Evidence</code> type can perform any arbitrary state transitions such as slashing, jailing, and tombstoning.</p> <h2 id="concepts"><a href="#concepts" class="header-anchor">#</a> Concepts</h2> <h3 id="evidence-2"><a href="#evidence-2" class="header-anchor">#</a> Evidence</h3> <p>Any concrete type of evidence submitted to the  module must fulfill the following <code>Evidence</code> contract. Not all concrete types of evidence will fulfill this contract in the same way, and some data might be entirely irrelevant to certain types of evidence. An additional <code>ValidatorEvidence</code>, which extends <code>Evidence</code>, has also been created to define a contract for evidence against malicious validators.</p> <div class="language- extra-class"><pre class="language-text"><code>// Evidence defines the contract which concrete evidence types of misbehavior
// must implement.
type Evidence interface {
	proto.Message

	Route() string
	Type() string
	String() string
	Hash() tmbytes.HexBytes
	ValidateBasic() error

	// Height at which the infraction occurred
	GetHeight() int64
}

// ValidatorEvidence extends Evidence interface to define contract
// for evidence against malicious validators
type ValidatorEvidence interface {
	Evidence

	// The consensus address of the malicious validator at time of infraction
	GetConsensusAddress() sdk.ConsAddress

	// The total power of the malicious validator at time of infraction
	GetValidatorPower() int64

	// The total validator set power at time of infraction
	GetTotalPower() int64
}
</code></pre></div><h3 id="registration-and-handling"><a href="#registration-and-handling" class="header-anchor">#</a> Registration and handling</h3> <p>First, the evidence module must know about all the types of evidence it is expected to handle. Register the <code>Route</code> method in the <code>Evidence</code> contract with a <code>Router</code> as defined below. The <code>Router</code> accepts <code>Evidence</code> and attempts to find the corresponding <code>Handler</code> for the <code>Evidence</code> via the <code>Route</code> method.</p> <div class="language- extra-class"><pre class="language-text"><code>type Router interface {
  AddRoute(r string, h Handler) Router
  HasRoute(r string) bool
  GetRoute(path string) Handler
  Seal()
  Sealed() bool
}
</code></pre></div><p>As defined below, the <code>Handler</code> is responsible for executing the entirety of the business logic for handling <code>Evidence</code>. Doing so typically includes validating the evidence, both stateless checks via <code>ValidateBasic</code> and stateful checks via any keepers provided to the <code>Handler</code>. Additionally, the <code>Handler</code> may also perform capabilities, such as slashing and jailing a validator. All <code>Evidence</code> handled by the <code>Handler</code> must be persisted.</p> <div class="language- extra-class"><pre class="language-text"><code>// Handler defines an agnostic Evidence handler. The handler is responsible
// for executing all corresponding business logic necessary for verifying the
// evidence as valid. In addition, the Handler may execute any necessary
// slashing and potential jailing.
type Handler func(sdk.Context, Evidence) error
</code></pre></div><h3 id="state"><a href="#state" class="header-anchor">#</a> State</h3> <p>The evidence module only stores valid submitted <code>Evidence</code> in state. The evidence state is also stored and exported in the evidence module's <code>GenesisState</code>.</p> <div class="language- extra-class"><pre class="language-text"><code>// GenesisState defines the evidence module's genesis state.
message GenesisState {
  // evidence defines all the evidence at genesis.
  repeated google.protobuf.Any evidence = 1;
}
</code></pre></div><h2 id="messages"><a href="#messages" class="header-anchor">#</a> Messages</h2> <h3 id="msgsubmitevidence"><a href="#msgsubmitevidence" class="header-anchor">#</a> MsgSubmitEvidence</h3> <p>Evidence is submitted through a <code>MsgSubmitEvidence</code> message:</p> <div class="language- extra-class"><pre class="language-text"><code>// MsgSubmitEvidence represents a message that supports submitting arbitrary
// Evidence of misbehavior such as equivocation or counterfactual signing.
message MsgSubmitEvidence {
  string              submitter = 1;
  google.protobuf.Any evidence  = 2;
}
</code></pre></div><p>The <code>Evidence</code> of a <code>MsgSubmitEvidence</code> message must have a corresponding <code>Handler</code> registered with the evidence module's <code>Router</code> to be processed and routed correctly.</p> <p>Given the <code>Evidence</code> is registered with a corresponding <code>Handler</code>, it is processed as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>func SubmitEvidence(ctx Context, evidence Evidence) error {
  if _, ok := GetEvidence(ctx, evidence.Hash()); ok {
    return sdkerrors.Wrap(types.ErrEvidenceExists, evidence.Hash().String())
  }
  if !router.HasRoute(evidence.Route()) {
    return sdkerrors.Wrap(types.ErrNoEvidenceHandlerExists, evidence.Route())
  }

  handler := router.GetRoute(evidence.Route())
  if err := handler(ctx, evidence); err != nil {
    return sdkerrors.Wrap(types.ErrInvalidEvidence, err.Error())
  }

  ctx.EventManager().EmitEvent(
		sdk.NewEvent(
			types.EventTypeSubmitEvidence,
			sdk.NewAttribute(types.AttributeKeyEvidenceHash, evidence.Hash().String()),
		),
	)

  SetEvidence(ctx, evidence)
  return nil
}
</code></pre></div><p>Valid submitted <code>Evidence</code> of the same type must not already exist. The <code>Evidence</code> is routed to the <code>Handler</code> and executed. If no error in handling the Evidence occurs, an event is emitted, and it is persisted to state.</p> <h3 id="events"><a href="#events" class="header-anchor">#</a> Events</h3> <p>The evidence module emits the following handler events:</p> <h4 id="msgsubmitevidence-2"><a href="#msgsubmitevidence-2" class="header-anchor">#</a> MsgSubmitEvidence</h4> <table><thead><tr><th>Type</th> <th>Attribute Key</th> <th>Attribute Value</th></tr></thead> <tbody><tr><td>submit_evidence</td> <td>evidence_hash</td> <td>{evidenceHash}</td></tr> <tr><td>message</td> <td>module</td> <td>evidence</td></tr> <tr><td>message</td> <td>sender</td> <td>{senderAddress}</td></tr> <tr><td>message</td> <td>action</td> <td>submit_evidence</td></tr></tbody></table> <h3 id="beginblock"><a href="#beginblock" class="header-anchor">#</a> BeginBlock</h3> <h4 id="evidence-handling"><a href="#evidence-handling" class="header-anchor">#</a> Evidence handling</h4> <p>Tendermint blocks can include
<a href="https://github.com/tendermint/tendermint/blob/master/docs/spec/blockchain/blockchain.md#evidence" target="_blank" rel="noopener noreferrer">Evidence<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that indicates whether a validator acted maliciously. The relevant information is forwarded to the application as ABCI Evidence in <code>abci.RequestBeginBlock</code> so that the validator can be punished accordingly.</p> <h4 id="equivocation"><a href="#equivocation" class="header-anchor">#</a> Equivocation</h4> <p>Currently, the SDK handles two types of evidence inside the ABCI <code>BeginBlock</code>:</p> <ul><li><code>DuplicateVoteEvidence</code>,</li> <li><code>LightClientAttackEvidence</code>.</li></ul> <p>The evidence module handles these two evidence types the same way. First, the SDK converts the Tendermint concrete evidence type to a SDK <code>Evidence</code> interface by using <code>Equivocation</code> as the concrete type.</p> <div class="language-proto extra-class"><pre class="language-text"><code>// Equivocation implements the Evidence interface.
message Equivocation {
  int64                     height            = 1;
  google.protobuf.Timestamp time              = 2;
  int64                     power             = 3;
  string                    consensus_address = 4;
}
</code></pre></div><p>For an <code>Equivocation</code> submitted in <code>block</code> to be valid, it must meet the following requirement:</p> <p><code>Evidence.Timestamp &gt;= block.Timestamp - MaxEvidenceAge</code></p> <p>where:</p> <ul><li><code>Evidence.Timestamp</code> is the timestamp in the block at height <code>Evidence.Height</code>.</li> <li><code>block.Timestamp</code> is the current block timestamp.</li></ul> <p>If valid <code>Equivocation</code> evidence is included in a block, the validator's stake is
reduced by <code>SlashFractionDoubleSign</code>, as defined by the <a href="/Reference/Terra-core/Module-specifications/spec-slashing.html">slashing module</a>. The reduction is implemented at the point when the infraction occurred instead of when the evidence was discovered.
The stake that contributed to the infraction is slashed, even if it has been redelegated or started unbonding.</p> <p>Additionally, the validator is permanently jailed and tombstoned so that the validator cannot re-enter the validator set again.</p> <details class="custom-block details"><summary>`Equivocation` evidence handling code</summary> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>k Keeper<span class="token punctuation">)</span> <span class="token function">HandleEquivocationEvidence</span><span class="token punctuation">(</span>ctx sdk<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> evidence <span class="token operator">*</span>types<span class="token punctuation">.</span>Equivocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	logger <span class="token operator">:=</span> k<span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
	consAddr <span class="token operator">:=</span> evidence<span class="token punctuation">.</span><span class="token function">GetConsensusAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> k<span class="token punctuation">.</span>slashingKeeper<span class="token punctuation">.</span><span class="token function">GetPubkey</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> consAddr<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token comment">// Ignore evidence that cannot be handled.</span>
		<span class="token comment">//</span>
		<span class="token comment">// NOTE: We used to panic with:</span>
		<span class="token comment">// `panic(fmt.Sprintf(&quot;Validator consensus-address %v not found&quot;, consAddr))`,</span>
		<span class="token comment">// but this couples the expectations of the app to both Tendermint and</span>
		<span class="token comment">// the simulator.  Both are expected to provide the full range of</span>
		<span class="token comment">// allowable but none of the disallowed evidence types.  Instead of</span>
		<span class="token comment">// getting this coordination right, it is easier to relax the</span>
		<span class="token comment">// constraints and ignore evidence that cannot be handled.</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// calculate the age of the evidence</span>
	infractionHeight <span class="token operator">:=</span> evidence<span class="token punctuation">.</span><span class="token function">GetHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	infractionTime <span class="token operator">:=</span> evidence<span class="token punctuation">.</span><span class="token function">GetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ageDuration <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">BlockHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>infractionTime<span class="token punctuation">)</span>
	ageBlocks <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">BlockHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Height <span class="token operator">-</span> infractionHeight

	<span class="token comment">// Reject evidence if the double-sign is too old. Evidence is considered stale</span>
	<span class="token comment">// if the difference in time and number of blocks is greater than the allowed</span>
	<span class="token comment">// parameters defined.</span>
	cp <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">ConsensusParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> cp <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> cp<span class="token punctuation">.</span>Evidence <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> ageDuration <span class="token operator">&gt;</span> cp<span class="token punctuation">.</span>Evidence<span class="token punctuation">.</span>MaxAgeDuration <span class="token operator">&amp;&amp;</span> ageBlocks <span class="token operator">&gt;</span> cp<span class="token punctuation">.</span>Evidence<span class="token punctuation">.</span>MaxAgeNumBlocks <span class="token punctuation">{</span>
			logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span>
				<span class="token string">&quot;ignored equivocation; evidence too old&quot;</span><span class="token punctuation">,</span>
				<span class="token string">&quot;validator&quot;</span><span class="token punctuation">,</span> consAddr<span class="token punctuation">,</span>
				<span class="token string">&quot;infraction_height&quot;</span><span class="token punctuation">,</span> infractionHeight<span class="token punctuation">,</span>
				<span class="token string">&quot;max_age_num_blocks&quot;</span><span class="token punctuation">,</span> cp<span class="token punctuation">.</span>Evidence<span class="token punctuation">.</span>MaxAgeNumBlocks<span class="token punctuation">,</span>
				<span class="token string">&quot;infraction_time&quot;</span><span class="token punctuation">,</span> infractionTime<span class="token punctuation">,</span>
				<span class="token string">&quot;max_age_duration&quot;</span><span class="token punctuation">,</span> cp<span class="token punctuation">.</span>Evidence<span class="token punctuation">.</span>MaxAgeDuration<span class="token punctuation">,</span>
			<span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	validator <span class="token operator">:=</span> k<span class="token punctuation">.</span>stakingKeeper<span class="token punctuation">.</span><span class="token function">ValidatorByConsAddr</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> consAddr<span class="token punctuation">)</span>
	<span class="token keyword">if</span> validator <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> validator<span class="token punctuation">.</span><span class="token function">IsUnbonded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Defensive: Simulation doesn't take unbonding periods into account, and</span>
		<span class="token comment">// Tendermint might break this assumption at some point.</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> ok <span class="token operator">:=</span> k<span class="token punctuation">.</span>slashingKeeper<span class="token punctuation">.</span><span class="token function">HasValidatorSigningInfo</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> consAddr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;expected signing info for validator %s but not found&quot;</span><span class="token punctuation">,</span> consAddr<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ignore if the validator is already tombstoned</span>
	<span class="token keyword">if</span> k<span class="token punctuation">.</span>slashingKeeper<span class="token punctuation">.</span><span class="token function">IsTombstoned</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> consAddr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span>
			<span class="token string">&quot;ignored equivocation; validator already tombstoned&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;validator&quot;</span><span class="token punctuation">,</span> consAddr<span class="token punctuation">,</span>
			<span class="token string">&quot;infraction_height&quot;</span><span class="token punctuation">,</span> infractionHeight<span class="token punctuation">,</span>
			<span class="token string">&quot;infraction_time&quot;</span><span class="token punctuation">,</span> infractionTime<span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span>
		<span class="token string">&quot;confirmed equivocation&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;validator&quot;</span><span class="token punctuation">,</span> consAddr<span class="token punctuation">,</span>
		<span class="token string">&quot;infraction_height&quot;</span><span class="token punctuation">,</span> infractionHeight<span class="token punctuation">,</span>
		<span class="token string">&quot;infraction_time&quot;</span><span class="token punctuation">,</span> infractionTime<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	<span class="token comment">// We need to retrieve the stake distribution which signed the block, so we</span>
	<span class="token comment">// subtract ValidatorUpdateDelay from the evidence height.</span>
	<span class="token comment">// Note, that this *can* result in a negative &quot;distributionHeight&quot;, up to</span>
	<span class="token comment">// -ValidatorUpdateDelay, i.e. at the end of the</span>
	<span class="token comment">// pre-genesis block (none) = at the beginning of the genesis block.</span>
	<span class="token comment">// That's fine since this is just used to filter unbonding delegations &amp; redelegations.</span>
	distributionHeight <span class="token operator">:=</span> infractionHeight <span class="token operator">-</span> sdk<span class="token punctuation">.</span>ValidatorUpdateDelay

	<span class="token comment">// Slash validator. The `power` is the int64 power of the validator as provided</span>
	<span class="token comment">// to/by Tendermint. This value is validator.Tokens as sent to Tendermint via</span>
	<span class="token comment">// ABCI, and now received as evidence. The fraction is passed in to separately</span>
	<span class="token comment">// to slash unbonding and rebonding delegations.</span>
	k<span class="token punctuation">.</span>slashingKeeper<span class="token punctuation">.</span><span class="token function">Slash</span><span class="token punctuation">(</span>
		ctx<span class="token punctuation">,</span>
		consAddr<span class="token punctuation">,</span>
		k<span class="token punctuation">.</span>slashingKeeper<span class="token punctuation">.</span><span class="token function">SlashFractionDoubleSign</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">,</span>
		evidence<span class="token punctuation">.</span><span class="token function">GetValidatorPower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> distributionHeight<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	<span class="token comment">// Jail the validator if not already jailed. This will begin unbonding the</span>
	<span class="token comment">// validator if not already unbonding (tombstoned).</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>validator<span class="token punctuation">.</span><span class="token function">IsJailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		k<span class="token punctuation">.</span>slashingKeeper<span class="token punctuation">.</span><span class="token function">Jail</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> consAddr<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	k<span class="token punctuation">.</span>slashingKeeper<span class="token punctuation">.</span><span class="token function">JailUntil</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> consAddr<span class="token punctuation">,</span> types<span class="token punctuation">.</span>DoubleSignJailEndTime<span class="token punctuation">)</span>
	k<span class="token punctuation">.</span>slashingKeeper<span class="token punctuation">.</span><span class="token function">Tombstone</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> consAddr<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <p>The slashing, jailing, and tombstoning calls are delegated through the slashing module, which emits informative events and finally delegates calls to the staking module. For more information about slashing and jailing, see <a href="/Reference/Terra-core/Module-specifications/spec-staking.html#transitions">transitions</a>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/terra-money/docs/edit/main/docs/Reference/Terra-core/Module-specifications/spec-evidence.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Updated on:</span> <span class="time">1/17/2022, 6:30:03 PM</span></div></footer> <div class="page-nav"><div class="inner"><div class="prev"><a href="/Reference/Terra-core/Module-specifications/spec-distribution.html">Distribution</a></div> <div class="next"><a href="/Reference/Terra-core/Module-specifications/spec-feegrant.html">Fee grant</a></div></div></div>  <div class="footer-container"><div class="company"><div class="copyright">Terraform labs PTE.LTD</div> <div class="subscribe"><div class="subscribe-title">Subscribe to get updates</div> <form action="https://money.us17.list-manage.com/subscribe/post?u=8eca8dc5c91c2e30d69b1463e&id=1447662093" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" novalidate="novalidate" class="validate"><input type="email" value name="EMAIL" id="mce-EMAIL" placeholder="Email address" required="required" class="email">
        real people should not fill this in and expect good things - do not remove this or risk form bot
        signups
        <div aria-hidden="true" style="position: absolute; left: -5000px;"><input type="text" name="b_8eca8dc5c91c2e30d69b1463e_1447662093" tabindex="-1" value></div> <button type="submit">Submit</button></form></div></div> <div class="links-container"><ul class="learn"><li>Learn</li> <li><a href="https://www.terra.money/Terra_White_paper.pdf" target="_blank">
          White
          Paper
        </a></li> <li><a href="https://certik.org/projects/terra" target="_blank">Security Audit</a></li> <li><a href="https://agora.terra.money/" target="_blank">Agora Discussions</a></li></ul> <ul class="developers"><li>Tools</li> <li><a href="https://station.terra.money/" target="_blank">Terra Station</a></li> <li><a href="https://finder.terra.money/" target="_blank">Terra Finder</a></li> <li><a href="https://status.terra.money/" target="_blank">Status</a></li></ul> <ul class="developers"><li>Luna</li> <li><a href="https://docs.terra.money/Concepts/Protocol.html#terra-and-luna" target="_blank">What is Luna?</a></li> <li><a href="https://docs.terra.money/Reference/integrations.html#exchanges" target="_blank">Exchanges</a></li> <li><a href="https://docs.terra.money/Reference/integrations.html#wallets" target="_blank">Wallets</a></li></ul> <ul class="developers"><li>Foundation</li> <li><a href="https://terra.breezy.hr/" target="_blank">Careers</a></li></ul> <ul class="developers"><li>Developers</li> <li><a href="https://github.com/terra-money" target="_blank">Github</a></li> <li><a href="https://docs.terra.money/" target="_blank">Documentation</a></li> <li><a href="https://docs.terra.money/#sdks-for-developers" target="_blank">SDKs</a></li> <li><a href="https://github.com/terra-money/TIPs" target="_blank">TIPs</a></li></ul> <ul class="developers"><li>Validators</li> <li><a href="https://docs.terra.money/How-to/Manage-a-Terra-validator/Overview.html" target="_blank">Validator Guide</a></li> <li><a href="https://github.com/terra-money/validator-profiles" target="_blank">Profiles</a></li> <li><a href="https://discord.gg/ZHBuKda" target="_blank">Discord Channel</a></li></ul></div> <div class="sns-container"><div class="logos"><a href="https://discord.gg/e29HWwC2Mz" rel="noopener" target="_blank"><img src="/img/discord.svg" alt="link to Terra discord room"></a> <a href="https://medium.com/terra-money" rel="noopener" target="_blank"><img src="/img/medium.svg" alt="link to Terra medium"></a> <a href="https://twitter.com/terra_money" rel="noopener" target="_blank"><img src="/img/twitter.svg" alt="link to Terra twitter"></a> <a href="https://www.youtube.com/channel/UCoV1RXZ9ZBGcuu_PMTTlM0g" rel="noopener" target="_blank"><img src="/img/icon_youtube.png" alt="link to Terra youtube"></a> <a href="https://t.me/terra_announcements" rel="noopener" target="_blank"><img src="/img/icon_telegram.png" alt="link to Terra telegram room"></a></div> <a href="https://www.terra.money" target="_blank" class="terramoney">terra.money</a></div></div></main></div><div class="global-ui"><div class="darkmode-switch"><div class="item day active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M512 256a42.666667 42.666667 0 0 0 42.666667-42.666667V128a42.666667 42.666667 0 0 0-85.333334 0v85.333333a42.666667 42.666667 0 0 0 42.666667 42.666667zM896 469.333333h-85.333333a42.666667 42.666667 0 0 0 0 85.333334h85.333333a42.666667 42.666667 0 0 0 0-85.333334zM256 512a42.666667 42.666667 0 0 0-42.666667-42.666667H128a42.666667 42.666667 0 0 0 0 85.333334h85.333333a42.666667 42.666667 0 0 0 42.666667-42.666667zM265.386667 213.333333a42.666667 42.666667 0 0 0-59.306667 62.72l61.44 59.306667a42.666667 42.666667 0 0 0 31.146667 11.946667 42.666667 42.666667 0 0 0 30.72-13.226667 42.666667 42.666667 0 0 0 0-60.16zM725.333333 347.306667a42.666667 42.666667 0 0 0 29.44-11.946667l61.44-59.306667A42.666667 42.666667 0 0 0 758.613333 213.333333l-61.44 60.586667a42.666667 42.666667 0 0 0 0 60.16 42.666667 42.666667 0 0 0 28.16 13.226667zM512 768a42.666667 42.666667 0 0 0-42.666667 42.666667v85.333333a42.666667 42.666667 0 0 0 85.333334 0v-85.333333a42.666667 42.666667 0 0 0-42.666667-42.666667zM756.48 688.64a42.666667 42.666667 0 0 0-59.306667 61.44L758.613333 810.666667a42.666667 42.666667 0 0 0 29.44 11.946666 42.666667 42.666667 0 0 0 30.72-12.8 42.666667 42.666667 0 0 0 0-60.586666zM267.52 688.64l-61.44 59.306667a42.666667 42.666667 0 0 0 0 60.586666 42.666667 42.666667 0 0 0 30.72 12.8 42.666667 42.666667 0 0 0 28.586667-10.666666l61.44-59.306667a42.666667 42.666667 0 0 0-59.306667-61.44zM512 341.333333a170.666667 170.666667 0 1 0 170.666667 170.666667 170.666667 170.666667 0 0 0-170.666667-170.666667z"></path></svg></div> <div class="item auto"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M460.864 539.072h103.936l-54.208-163.072-49.728 163.072z m411.136-176.704V149.504h-212.352L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352v-212.928l149.12-149.504-149.184-149.504zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624H320.768l144.576-407.68h90.368l144.576 407.68H614.464z m0 0"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M935.538601 630.40178c-11.43005-11.432249-28.673759-14.738607-43.531086-8.353536-46.733115 20.10317-96.362866 30.296859-147.50719 30.296859-99.589478 0-193.221796-38.783705-263.640252-109.20316-108.636744-108.636744-139.609745-270.022125-78.9083-411.148441 6.388069-14.85233 3.078713-32.098837-8.353536-43.532285-11.432249-11.432249-28.675758-14.743604-43.532285-8.354536-52.637312 22.64025-100.017388 54.809439-140.82552 95.616372-85.346135 85.346135-132.346869 198.821199-132.346869 319.519766 0 120.699566 47.001733 234.172631 132.347868 319.518766s198.821199 132.349067 319.517567 132.349067c120.699566 0 234.172431-47.002932 319.520765-132.351066 40.808132-40.810131 72.977122-88.190207 95.615373-140.82552C950.282205 659.081735 946.971849 641.834029 935.538601 630.40178z" p-id="3638"></path></svg></div></div></div></div>
    <script src="/assets/js/app.5daa07b7.js" defer></script><script src="/assets/js/3.bd3f871b.js" defer></script><script src="/assets/js/47.2afae3bf.js" defer></script>
  </body>
</html>
