<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Writing the Contract | Terra Docs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" type="text/css" href="https://cloud.typography.com/7420256/6416592/css/fonts.css">
    <link rel="stylesheet" type="text/css" href="https://www.terra.money/static/fonts/jetbrainsMono.css?updated=190220">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:400,500,700&amp;display=swap">
    <link rel="icon" type="image/png" href="/img/favicon.png">
    <script>window.onload = function() {
        requestAnimationFrame(function() {
          if (location.hash) {
            const element = document.getElementById(location.hash.slice(1))

            if (element) {
              element.scrollIntoView()
            }
          }
        })
      }</script>
    <meta name="description" content="Terra is an open source, public blockchain protocol that provides fundamental infrastructure for a decentralized economy and enables open participation in the creation of new financial primitives to power the innovation of money.">
    
    <link rel="preload" href="/assets/css/0.styles.b90d9300.css" as="style"><link rel="preload" href="/assets/js/app.5daa07b7.js" as="script"><link rel="preload" href="/assets/js/3.bd3f871b.js" as="script"><link rel="preload" href="/assets/js/94.abfbf92f.js" as="script"><link rel="prefetch" href="/assets/js/10.702f2eeb.js"><link rel="prefetch" href="/assets/js/11.d83e4c08.js"><link rel="prefetch" href="/assets/js/12.30fd6fcf.js"><link rel="prefetch" href="/assets/js/13.463c7cf2.js"><link rel="prefetch" href="/assets/js/14.7443f057.js"><link rel="prefetch" href="/assets/js/15.cc2ff474.js"><link rel="prefetch" href="/assets/js/16.b7303649.js"><link rel="prefetch" href="/assets/js/17.7ff360e0.js"><link rel="prefetch" href="/assets/js/18.3c97efdf.js"><link rel="prefetch" href="/assets/js/19.767c628a.js"><link rel="prefetch" href="/assets/js/20.c3b67c7e.js"><link rel="prefetch" href="/assets/js/21.ed81322c.js"><link rel="prefetch" href="/assets/js/22.d813ec61.js"><link rel="prefetch" href="/assets/js/23.6be4c4be.js"><link rel="prefetch" href="/assets/js/24.214d78e4.js"><link rel="prefetch" href="/assets/js/25.d1efda93.js"><link rel="prefetch" href="/assets/js/26.23be4177.js"><link rel="prefetch" href="/assets/js/27.65a41319.js"><link rel="prefetch" href="/assets/js/28.ed5c3ce8.js"><link rel="prefetch" href="/assets/js/29.fb35e146.js"><link rel="prefetch" href="/assets/js/30.3ccea319.js"><link rel="prefetch" href="/assets/js/31.4ca0a94d.js"><link rel="prefetch" href="/assets/js/32.1397be91.js"><link rel="prefetch" href="/assets/js/33.07cebc57.js"><link rel="prefetch" href="/assets/js/34.ced6c4b7.js"><link rel="prefetch" href="/assets/js/35.02953aa8.js"><link rel="prefetch" href="/assets/js/36.511aafec.js"><link rel="prefetch" href="/assets/js/37.fdee8eb1.js"><link rel="prefetch" href="/assets/js/38.b02aefb5.js"><link rel="prefetch" href="/assets/js/39.e3b0f4ad.js"><link rel="prefetch" href="/assets/js/4.8e884616.js"><link rel="prefetch" href="/assets/js/40.f5f6e6e2.js"><link rel="prefetch" href="/assets/js/41.e385cd8c.js"><link rel="prefetch" href="/assets/js/42.0795be7c.js"><link rel="prefetch" href="/assets/js/43.03b58b2c.js"><link rel="prefetch" href="/assets/js/44.ba137eea.js"><link rel="prefetch" href="/assets/js/45.61537e5c.js"><link rel="prefetch" href="/assets/js/46.dfc54f76.js"><link rel="prefetch" href="/assets/js/47.2afae3bf.js"><link rel="prefetch" href="/assets/js/48.600d34d0.js"><link rel="prefetch" href="/assets/js/49.6a785721.js"><link rel="prefetch" href="/assets/js/5.cfa43d54.js"><link rel="prefetch" href="/assets/js/50.cc21253f.js"><link rel="prefetch" href="/assets/js/51.03862bbb.js"><link rel="prefetch" href="/assets/js/52.b6ed118d.js"><link rel="prefetch" href="/assets/js/53.9974fba3.js"><link rel="prefetch" href="/assets/js/54.52c2475b.js"><link rel="prefetch" href="/assets/js/55.805a376a.js"><link rel="prefetch" href="/assets/js/56.50135bed.js"><link rel="prefetch" href="/assets/js/57.af392382.js"><link rel="prefetch" href="/assets/js/58.0ed5c001.js"><link rel="prefetch" href="/assets/js/59.d985eb4d.js"><link rel="prefetch" href="/assets/js/6.853fdd43.js"><link rel="prefetch" href="/assets/js/60.fc6822e4.js"><link rel="prefetch" href="/assets/js/61.65d0c9ad.js"><link rel="prefetch" href="/assets/js/62.8d356e47.js"><link rel="prefetch" href="/assets/js/63.93ea2dd9.js"><link rel="prefetch" href="/assets/js/64.c399be85.js"><link rel="prefetch" href="/assets/js/65.1ce26d20.js"><link rel="prefetch" href="/assets/js/66.caa689fd.js"><link rel="prefetch" href="/assets/js/67.07a60e0f.js"><link rel="prefetch" href="/assets/js/68.2ab299b4.js"><link rel="prefetch" href="/assets/js/69.e3b97a46.js"><link rel="prefetch" href="/assets/js/7.0a026085.js"><link rel="prefetch" href="/assets/js/70.1de1c1e9.js"><link rel="prefetch" href="/assets/js/71.a837a9b4.js"><link rel="prefetch" href="/assets/js/72.ad9e6958.js"><link rel="prefetch" href="/assets/js/73.e5f402df.js"><link rel="prefetch" href="/assets/js/74.f4a9a475.js"><link rel="prefetch" href="/assets/js/75.a22d689c.js"><link rel="prefetch" href="/assets/js/76.2a314a8b.js"><link rel="prefetch" href="/assets/js/77.dbcaf9c0.js"><link rel="prefetch" href="/assets/js/78.4d0ab581.js"><link rel="prefetch" href="/assets/js/79.f99146bb.js"><link rel="prefetch" href="/assets/js/8.087c7e3b.js"><link rel="prefetch" href="/assets/js/80.c61f507f.js"><link rel="prefetch" href="/assets/js/81.bc47d9cf.js"><link rel="prefetch" href="/assets/js/82.ca602b8e.js"><link rel="prefetch" href="/assets/js/83.a0de260d.js"><link rel="prefetch" href="/assets/js/84.865f2a5b.js"><link rel="prefetch" href="/assets/js/85.6ce94127.js"><link rel="prefetch" href="/assets/js/86.fbb52d1c.js"><link rel="prefetch" href="/assets/js/87.bc68c044.js"><link rel="prefetch" href="/assets/js/88.558000c2.js"><link rel="prefetch" href="/assets/js/89.d3d1cc42.js"><link rel="prefetch" href="/assets/js/9.5c8389f5.js"><link rel="prefetch" href="/assets/js/90.56dcd92d.js"><link rel="prefetch" href="/assets/js/91.279946a8.js"><link rel="prefetch" href="/assets/js/92.7aae198a.js"><link rel="prefetch" href="/assets/js/93.884328a7.js"><link rel="prefetch" href="/assets/js/95.3f6a6eb3.js"><link rel="prefetch" href="/assets/js/96.4609ac8b.js"><link rel="prefetch" href="/assets/js/97.6228f4cb.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.1b3c7a9c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b90d9300.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"></div> <a href="/" class="home-link router-link-active"><img src="/img/docs_logo.svg" alt="Terra Docs" class="logo"> <span class="site-name can-hide">Terra Docs</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Overview</a></div><div class="nav-item"><a href="/Tutorials/" class="nav-link router-link-active">Tutorials</a></div><div class="nav-item"><a href="/How-to/" class="nav-link">How to</a></div><div class="nav-item"><a href="/Concepts/" class="nav-link">Concepts</a></div><div class="nav-item"><a href="/Reference/" class="nav-link">Reference</a></div><div class="nav-item"><a href="/SDKs/" class="nav-link">SDKs</a></div><div class="nav-item"><a href="https://github.com/terra-money/core" target="_blank" rel="noopener noreferrer" class="nav-link external"><div class="nav-icon"><img src="/img/github.svg"></div></a></div></nav> <form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form></div></header> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Overview</a></div><div class="nav-item"><a href="/Tutorials/" class="nav-link router-link-active">Tutorials</a></div><div class="nav-item"><a href="/How-to/" class="nav-link">How to</a></div><div class="nav-item"><a href="/Concepts/" class="nav-link">Concepts</a></div><div class="nav-item"><a href="/Reference/" class="nav-link">Reference</a></div><div class="nav-item"><a href="/SDKs/" class="nav-link">SDKs</a></div><div class="nav-item"><a href="https://github.com/terra-money/core" target="_blank" rel="noopener noreferrer" class="nav-link external"><div class="nav-icon"><img src="/img/github.svg"></div></a></div></nav>  <ul class="sidebar-links"><li><a href="/Tutorials/" aria-current="page" class="sidebar-link">Tutorials</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Get started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Developer's 5-minute guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Build a simple Terra dApp</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Tutorials/Smart-contracts/Overview.html" class="sidebar-link">Overview</a></li><li><a href="/Tutorials/Smart-contracts/Build-Terra-dApp.html" class="sidebar-link">Build a simple Terra dApp</a></li><li><a href="/Tutorials/Smart-contracts/Set-up-local-environment.html" class="sidebar-link">Environment Setup</a></li><li><a href="/Tutorials/Smart-contracts/Write-smart-contract.html" aria-current="page" class="active sidebar-link">Writing the Contract</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#start-with-a-template" class="sidebar-link">Start with a template</a></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#contract-state" class="sidebar-link">Contract State</a></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#instantiatemsg" class="sidebar-link">InstantiateMsg</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#example" class="sidebar-link">Example</a></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#message-definition" class="sidebar-link">Message Definition</a></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#logic" class="sidebar-link">Logic</a></li></ul></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#executemsg" class="sidebar-link">ExecuteMsg</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#example-2" class="sidebar-link">Example</a></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#message-definition-2" class="sidebar-link">Message Definition</a></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#logic-2" class="sidebar-link">Logic</a></li></ul></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#querymsg" class="sidebar-link">QueryMsg</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#example-3" class="sidebar-link">Example</a></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#message-definition-3" class="sidebar-link">Message Definition</a></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#logic-3" class="sidebar-link">Logic</a></li></ul></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#building-the-contract" class="sidebar-link">Building the Contract</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#optimizing-your-build" class="sidebar-link">Optimizing your build</a></li></ul></li><li class="sidebar-sub-header"><a href="/Tutorials/Smart-contracts/Write-smart-contract.html#schemas" class="sidebar-link">Schemas</a></li></ul></li><li><a href="/Tutorials/Smart-contracts/Interact-with-smart-contract.html" class="sidebar-link">Interacting with the Contract</a></li><li><a href="/Tutorials/Smart-contracts/Manage-CW20-tokens.html" class="sidebar-link">CW20 Tokens</a></li></ul></section></li></ul>  <div class="sidebar_footer"></div></aside> <main class="page"> <nav id="breadcrumb" class="breadcrumb-container" data-v-7ebed944><a href="/" class="breadcrumb router-link-active" data-v-7ebed944><span data-v-7ebed944>Terra Docs</span></a><a href="/Tutorials/" class="breadcrumb router-link-active" data-v-7ebed944><span data-v-7ebed944>Tutorials</span></a><a href="/Tutorials/Smart-contracts/Write-smart-contract.html" aria-current="page" class="breadcrumb router-link-exact-active router-link-active" data-v-7ebed944><span data-v-7ebed944>Writing the Contract</span></a></nav> <div class="theme-default-content content__default"><h1 id="writing-the-contract"><a href="#writing-the-contract" class="header-anchor">#</a> Writing the Contract</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>To better understand the building blocks of the smart contract you will build in this tutorial, view the <a href="https://github.com/CosmWasm/cw-template" target="_blank" rel="noopener noreferrer">complete contract<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <p>A smart contract can be considered an instance of a singleton object whose internal state is persisted on the blockchain. Users can trigger state changes through sending it JSON messages, and users can also query its state through sending a request formatted as a JSON message. These messages are different than Terra blockchain messages such as <code>MsgSend</code> and <code>MsgSwap</code>.</p> <p>As a smart contract writer, your job is to define 3 functions that define your smart contract's interface:</p> <ul><li><code>instantiate()</code>: a constructor which is called during contract instantiation to provide initial state</li> <li><code>execute()</code>: gets called when a user wants to invoke a method on the smart contract</li> <li><code>query()</code>: gets called when a user wants to get data out of a smart contract</li></ul> <p>In this section, we'll define our expected messages alongside their implementation.</p> <h2 id="start-with-a-template"><a href="#start-with-a-template" class="header-anchor">#</a> Start with a template</h2> <p>In your working directory, quickly launch your smart contract with the recommended folder structure and build options by running the following commands:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>cargo generate --git https://github.com/CosmWasm/cw-template.git --branch <span class="token number">0.16</span> --name my-first-contract
<span class="token builtin class-name">cd</span> my-first-contract
</code></pre></div><p>This helps get you started by providing the basic boilerplate and structure for a smart contract. You'll find in the <code>src/lib.rs</code> file that the standard CosmWasm entrypoints <code>instantiate()</code>, <code>execute()</code>, and <code>query()</code> are properly exposed and hooked up.</p> <h2 id="contract-state"><a href="#contract-state" class="header-anchor">#</a> Contract State</h2> <p>The starting template has the basic following state:</p> <ul><li>a singleton struct <code>State</code> containing:
<ul><li>a 32-bit integer <code>count</code></li> <li>a Terra address <code>owner</code></li></ul></li></ul> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// src/state.rs</span>
<span class="token keyword">use</span> <span class="token namespace">schemars<span class="token punctuation">::</span></span><span class="token class-name">JsonSchema</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">cosmwasm_std<span class="token punctuation">::</span></span><span class="token class-name">Addr</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">cw_storage_plus<span class="token punctuation">::</span></span><span class="token class-name">Item</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">State</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> owner<span class="token punctuation">:</span> <span class="token class-name">Addr</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">STATE</span><span class="token punctuation">:</span> <span class="token class-name">Item</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">Item</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&quot;state&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Terra smart contracts have the ability to keep persistent state through Terra's native LevelDB, a bytes-based key-value store. As such, any data you wish to persist should be assigned a unique key at which the data can be indexed and later retrieved. The singleton in our example above is assigned the key <code>config</code> (in bytes).</p> <p>Data can only be persisted as raw bytes, so any notion of structure or data type must be expressed as a pair of serializing and deserializing functions. For instance, objects must be stored as bytes, so you must supply both the function that encodes the object into bytes to save it on the blockchain, as well as the function that decodes the bytes back into data types that your contract logic can understand. The choice of byte representation is up to you, so long as it provides a clean, bi-directional mapping.</p> <p>Fortunately, the CosmWasm team have provided utility crates such as <a href="https://github.com/CosmWasm/cosmwasm/tree/master/packages/storage" target="_blank" rel="noopener noreferrer">cosmwasm_storage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which provides convenient high-level abstractions for data containers such as a &quot;singleton&quot; and &quot;bucket&quot;, which automatically provide serialization and deserialization for commonly-used types such as structs and Rust numbers.</p> <p>Notice how the <code>State</code> struct holds both <code>count</code> and <code>owner</code>. In addition, the <code>derive</code> attribute is applied to auto-implement some useful traits:</p> <ul><li><code>Serialize</code>: provides serialization</li> <li><code>Deserialize</code>: provides deserialization</li> <li><code>Clone</code>: makes our struct copyable</li> <li><code>Debug</code>: enables our struct to be printed to string</li> <li><code>PartialEq</code>: gives us equality comparison</li> <li><code>JsonSchema</code>: auto-generates a JSON schema for us</li></ul> <p><code>Addr</code>, refers to a human-readable Terra address prefixed with <code>terra...</code>. Its counterpart is the <code>CanonicalAddr</code>, which refers to a Terra address's native decoded Bech32 form in bytes.</p> <h2 id="instantiatemsg"><a href="#instantiatemsg" class="header-anchor">#</a> InstantiateMsg</h2> <p>The <code>InstantiateMsg</code> is provided when a user creates a contract on the blockchain through a <code>MsgInstantiateContract</code>. This provides the contract with its configuration as well as its initial state.</p> <p>On the Terra blockchain, the uploading of a contract's code and the instantiation of a contract are regarded as separate events, unlike on Ethereum. This is to allow a small set of vetted contract archetypes to exist as multiple instances sharing the same base code but configured with different parameters (imagine one canonical ERC20, and multiple tokens that use its code).</p> <h3 id="example"><a href="#example" class="header-anchor">#</a> Example</h3> <p>For our contract, we will expect a contract creator to supply the initial state in a JSON message:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token number">100</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="message-definition"><a href="#message-definition" class="header-anchor">#</a> Message Definition</h3> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// src/msg.rs</span>

<span class="token keyword">use</span> <span class="token namespace">schemars<span class="token punctuation">::</span></span><span class="token class-name">JsonSchema</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">InstantiateMsg</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="logic"><a href="#logic" class="header-anchor">#</a> Logic</h3> <p>Here we define our first entry-point, the <code>instantiate()</code>, or where the contract is instantiated and passed its <code>InstantiateMsg</code>. We extract the count from the message and set up our initial state, where:</p> <ul><li><code>count</code> is assigned the count from the message</li> <li><code>owner</code> is assigned to the sender of the <code>MsgInstantiateContract</code></li></ul> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// src/contract.rs</span>
<span class="token attribute attr-name">#[cfg_attr(not(feature = <span class="token string">&quot;library&quot;</span>), entry_point)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">instantiate</span><span class="token punctuation">(</span>
    deps<span class="token punctuation">:</span> <span class="token class-name">DepsMut</span><span class="token punctuation">,</span>
    _env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span>
    info<span class="token punctuation">:</span> <span class="token class-name">MessageInfo</span><span class="token punctuation">,</span>
    msg<span class="token punctuation">:</span> <span class="token class-name">InstantiateMsg</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> msg<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
        owner<span class="token punctuation">:</span> info<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">set_contract_version</span><span class="token punctuation">(</span>deps<span class="token punctuation">.</span>storage<span class="token punctuation">,</span> <span class="token constant">CONTRACT_NAME</span><span class="token punctuation">,</span> <span class="token constant">CONTRACT_VERSION</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>deps<span class="token punctuation">.</span>storage<span class="token punctuation">,</span> <span class="token operator">&amp;</span>state<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">add_attribute</span><span class="token punctuation">(</span><span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;instantiate&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">add_attribute</span><span class="token punctuation">(</span><span class="token string">&quot;owner&quot;</span><span class="token punctuation">,</span> info<span class="token punctuation">.</span>sender<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">add_attribute</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>count<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="executemsg"><a href="#executemsg" class="header-anchor">#</a> ExecuteMsg</h2> <p>The <code>ExecuteMsg</code> is a JSON message passed to the <code>execute()</code> function through a <code>MsgExecuteContract</code>. Unlike the <code>InstantiateMsg</code>, the <code>ExecuteMsg</code> can exist as several different types of messages, to account for the different types of functions that a smart contract can expose to a user. The <code>execute()</code> function demultiplexes these different types of messages to its appropriate message handler logic.</p> <h3 id="example-2"><a href="#example-2" class="header-anchor">#</a> Example</h3> <h4 id="increment"><a href="#increment" class="header-anchor">#</a> Increment</h4> <p>Any user can increment the current count by 1.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;increment&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="reset"><a href="#reset" class="header-anchor">#</a> Reset</h4> <p>Only the owner can reset the count to a specific number.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;reset&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token number">5</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="message-definition-2"><a href="#message-definition-2" class="header-anchor">#</a> Message Definition</h3> <p>As for our <code>ExecuteMsg</code>, we will use an <code>enum</code> to multiplex over the different types of messages that our contract can understand. The <code>serde</code> attribute rewrites our attribute keys in snake case and lower case, so we'll have <code>increment</code> and <code>reset</code> instead of <code>Increment</code> and <code>Reset</code> when serializing and deserializing across JSON.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// src/msg.rs</span>

<span class="token attribute attr-name">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span>
<span class="token attribute attr-name">#[serde(rename_all = <span class="token string">&quot;snake_case&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">ExecuteMsg</span> <span class="token punctuation">{</span>
    <span class="token class-name">Increment</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">Reset</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="logic-2"><a href="#logic-2" class="header-anchor">#</a> Logic</h3> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// src/contract.rs</span>

<span class="token attribute attr-name">#[cfg_attr(not(feature = <span class="token string">&quot;library&quot;</span>), entry_point)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">execute</span><span class="token punctuation">(</span>
    deps<span class="token punctuation">:</span> <span class="token class-name">DepsMut</span><span class="token punctuation">,</span>
    _env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span>
    info<span class="token punctuation">:</span> <span class="token class-name">MessageInfo</span><span class="token punctuation">,</span>
    msg<span class="token punctuation">:</span> <span class="token class-name">ExecuteMsg</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> msg <span class="token punctuation">{</span>
        <span class="token class-name">ExecuteMsg</span><span class="token punctuation">::</span><span class="token class-name">Increment</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token function">try_increment</span><span class="token punctuation">(</span>deps<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">ExecuteMsg</span><span class="token punctuation">::</span><span class="token class-name">Reset</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token function">try_reset</span><span class="token punctuation">(</span>deps<span class="token punctuation">,</span> info<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is our <code>execute()</code> method, which uses Rust's pattern matching to route the received <code>ExecuteMsg</code> to the appropriate handling logic, either dispatching a <code>try_increment()</code> or a <code>try_reset()</code> call depending on the message received.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">try_increment</span><span class="token punctuation">(</span>deps<span class="token punctuation">:</span> <span class="token class-name">DepsMut</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>deps<span class="token punctuation">.</span>storage<span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token keyword">mut</span> state<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span>_<span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add_attribute</span><span class="token punctuation">(</span><span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;try_increment&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>It is quite straightforward to follow the logic of <code>try_increment()</code>. We acquire a mutable reference to the storage to update the singleton located at key <code>b&quot;config&quot;</code>, made accessible through the <code>config</code> convenience function defined in the <code>src/state.rs</code>. We then update the present state's count by returning an <code>Ok</code> result with the new state. Finally, we terminate the contract's execution with an acknowledgement of success by returning an <code>Ok</code> result with the <code>Response</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// src/contract.rs</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">try_reset</span><span class="token punctuation">(</span>deps<span class="token punctuation">:</span> <span class="token class-name">DepsMut</span><span class="token punctuation">,</span> info<span class="token punctuation">:</span> <span class="token class-name">MessageInfo</span><span class="token punctuation">,</span> count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>deps<span class="token punctuation">.</span>storage<span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token keyword">mut</span> state<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span>_<span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> info<span class="token punctuation">.</span>sender <span class="token operator">!=</span> state<span class="token punctuation">.</span>owner <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ContractError</span><span class="token punctuation">::</span><span class="token class-name">Unauthorized</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        state<span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add_attribute</span><span class="token punctuation">(</span><span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;reset&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The logic for reset is very similar to increment -- except this time, we first check that the message sender is permitted to invoke the reset function.</p> <h2 id="querymsg"><a href="#querymsg" class="header-anchor">#</a> QueryMsg</h2> <h3 id="example-3"><a href="#example-3" class="header-anchor">#</a> Example</h3> <p>The template contract only supports one type of <code>QueryMsg</code>:</p> <h4 id="balance"><a href="#balance" class="header-anchor">#</a> Balance</h4> <p>The request:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;get_count&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which should return:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token number">5</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="message-definition-3"><a href="#message-definition-3" class="header-anchor">#</a> Message Definition</h3> <p>To support queries against our contract for data, we'll have to define both a <code>QueryMsg</code> format (which represents requests), as well as provide the structure of the query's output -- <code>CountResponse</code> in this case. We must do this because <code>query()</code> will send back information to the user through JSON in a structure and we must make the shape of our response known.</p> <p>Add the following to your <code>src/msg.rs</code>:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// src/msg.rs</span>
<span class="token attribute attr-name">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span>
<span class="token attribute attr-name">#[serde(rename_all = <span class="token string">&quot;snake_case&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">QueryMsg</span> <span class="token punctuation">{</span>
    <span class="token comment">// GetCount returns the current count as a json-encoded number</span>
    <span class="token class-name">GetCount</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// We define a custom struct for each query response</span>
<span class="token attribute attr-name">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">CountResponse</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="logic-3"><a href="#logic-3" class="header-anchor">#</a> Logic</h3> <p>The logic for <code>query()</code> should be similar to that of <code>execute()</code>, except that, since <code>query()</code> is called without the end-user making a transaction, we omit the <code>env</code> argument as there is no information.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// src/contract.rs</span>

<span class="token attribute attr-name">#[cfg_attr(not(feature = <span class="token string">&quot;library&quot;</span>), entry_point)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">query</span><span class="token punctuation">(</span>deps<span class="token punctuation">:</span> <span class="token class-name">Deps</span><span class="token punctuation">,</span> _env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span> msg<span class="token punctuation">:</span> <span class="token class-name">QueryMsg</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">StdResult</span><span class="token operator">&lt;</span><span class="token class-name">Binary</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> msg <span class="token punctuation">{</span>
        <span class="token class-name">QueryMsg</span><span class="token punctuation">::</span><span class="token class-name">GetCount</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token function">to_binary</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token function">query_count</span><span class="token punctuation">(</span>deps<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">query_count</span><span class="token punctuation">(</span>deps<span class="token punctuation">:</span> <span class="token class-name">Deps</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">StdResult</span><span class="token operator">&lt;</span><span class="token class-name">CountResponse</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>deps<span class="token punctuation">.</span>storage<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">CountResponse</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="building-the-contract"><a href="#building-the-contract" class="header-anchor">#</a> Building the Contract</h2> <p>To build your contract, run the following command. This will check for any preliminary errors before optimizing.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>cargo wasm
</code></pre></div><h3 id="optimizing-your-build"><a href="#optimizing-your-build" class="header-anchor">#</a> Optimizing your build</h3> <div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>You will need <a href="https://www.docker.com" target="_blank" rel="noopener noreferrer">Docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> installed to run this command.</p></div> <p>You will need to make sure the output WASM binary is as small as possible in order to minimize fees and stay under the size limit for the blockchain. Run the following command in the root directory of your Rust smart contract's project folder.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>cargo run-script optimize
</code></pre></div><p>Or, if you are on an arm64 machine:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker run --rm -v <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>&quot;</span>:/code <span class="token punctuation">\</span>
  --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>volume,source<span class="token operator">=</span><span class="token string">&quot;$(basename &quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>&quot;</span><span class="token punctuation">)</span>_cache&quot;,target<span class="token operator">=</span>/code/target <span class="token punctuation">\</span>
  --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>volume,source<span class="token operator">=</span>registry_cache,target<span class="token operator">=</span>/usr/local/cargo/registry <span class="token punctuation">\</span>
  cosmwasm/rust-optimizer-arm64:0.12.4
</code></pre></div><p>This will result in an optimized build of <code>artifacts/my_first_contract.wasm</code> or <code>artifacts/my_first_contract-aarch64.wasm</code> in your working directory.</p> <div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>Please note that rust-optimizer will produce different contracts on Intel and ARM machines. So for reproducible builds you'll have to stick to one.</p></div> <h2 id="schemas"><a href="#schemas" class="header-anchor">#</a> Schemas</h2> <p>In order to make use of JSON-schema auto-generation, we should register each of the data structures that we need schemas for.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// examples/schema.rs</span>

<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span>current_dir<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span>create_dir_all<span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">cosmwasm_schema<span class="token punctuation">::</span></span><span class="token punctuation">{</span>export_schema<span class="token punctuation">,</span> remove_schemas<span class="token punctuation">,</span> schema_for<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">my_first_contract<span class="token punctuation">::</span>msg<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">CountResponse</span><span class="token punctuation">,</span> <span class="token class-name">HandleMsg</span><span class="token punctuation">,</span> <span class="token class-name">InitMsg</span><span class="token punctuation">,</span> <span class="token class-name">QueryMsg</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">my_first_contract<span class="token punctuation">::</span>state<span class="token punctuation">::</span></span><span class="token class-name">State</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> out_dir <span class="token operator">=</span> <span class="token function">current_dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out_dir<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;schema&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">create_dir_all</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>out_dir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">remove_schemas</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>out_dir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">export_schema</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">schema_for!</span><span class="token punctuation">(</span><span class="token class-name">InstantiateMsg</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>out_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">export_schema</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">schema_for!</span><span class="token punctuation">(</span><span class="token class-name">ExecuteMsg</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>out_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">export_schema</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">schema_for!</span><span class="token punctuation">(</span><span class="token class-name">QueryMsg</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>out_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">export_schema</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">schema_for!</span><span class="token punctuation">(</span><span class="token class-name">State</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>out_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">export_schema</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">schema_for!</span><span class="token punctuation">(</span><span class="token class-name">CountResponse</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>out_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can then build the schemas with:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>cargo schema
</code></pre></div><p>Your newly generated schemas should be visible in your <code>schema/</code> directory. The following is an example of <code>schema/query_msg.json</code>.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;$schema&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://json-schema.org/draft-07/schema#&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;QueryMsg&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;anyOf&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get_count&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;get_count&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;object&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can use an online tool such as <a href="https://www.jsonschemavalidator.net/" target="_blank" rel="noopener noreferrer">JSON Schema Validator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to test your input against the generated JSON schema.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/terra-money/docs/edit/main/docs/Tutorials/Smart-contracts/Write-smart-contract.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Updated on:</span> <span class="time">1/17/2022, 6:30:03 PM</span></div></footer> <div class="page-nav"><div class="inner"><div class="prev"><a href="/Tutorials/Smart-contracts/Set-up-local-environment.html">Environment Setup</a></div> <div class="next"><a href="/Tutorials/Smart-contracts/Interact-with-smart-contract.html">Interacting with the Contract</a></div></div></div>  <div class="footer-container"><div class="company"><div class="copyright">Terraform labs PTE.LTD</div> <div class="subscribe"><div class="subscribe-title">Subscribe to get updates</div> <form action="https://money.us17.list-manage.com/subscribe/post?u=8eca8dc5c91c2e30d69b1463e&id=1447662093" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" novalidate="novalidate" class="validate"><input type="email" value name="EMAIL" id="mce-EMAIL" placeholder="Email address" required="required" class="email">
        real people should not fill this in and expect good things - do not remove this or risk form bot
        signups
        <div aria-hidden="true" style="position: absolute; left: -5000px;"><input type="text" name="b_8eca8dc5c91c2e30d69b1463e_1447662093" tabindex="-1" value></div> <button type="submit">Submit</button></form></div></div> <div class="links-container"><ul class="learn"><li>Learn</li> <li><a href="https://www.terra.money/Terra_White_paper.pdf" target="_blank">
          White
          Paper
        </a></li> <li><a href="https://certik.org/projects/terra" target="_blank">Security Audit</a></li> <li><a href="https://agora.terra.money/" target="_blank">Agora Discussions</a></li></ul> <ul class="developers"><li>Tools</li> <li><a href="https://station.terra.money/" target="_blank">Terra Station</a></li> <li><a href="https://finder.terra.money/" target="_blank">Terra Finder</a></li> <li><a href="https://status.terra.money/" target="_blank">Status</a></li></ul> <ul class="developers"><li>Luna</li> <li><a href="https://docs.terra.money/Concepts/Protocol.html#terra-and-luna" target="_blank">What is Luna?</a></li> <li><a href="https://docs.terra.money/Reference/integrations.html#exchanges" target="_blank">Exchanges</a></li> <li><a href="https://docs.terra.money/Reference/integrations.html#wallets" target="_blank">Wallets</a></li></ul> <ul class="developers"><li>Foundation</li> <li><a href="https://terra.breezy.hr/" target="_blank">Careers</a></li></ul> <ul class="developers"><li>Developers</li> <li><a href="https://github.com/terra-money" target="_blank">Github</a></li> <li><a href="https://docs.terra.money/" target="_blank">Documentation</a></li> <li><a href="https://docs.terra.money/#sdks-for-developers" target="_blank">SDKs</a></li> <li><a href="https://github.com/terra-money/TIPs" target="_blank">TIPs</a></li></ul> <ul class="developers"><li>Validators</li> <li><a href="https://docs.terra.money/How-to/Manage-a-Terra-validator/Overview.html" target="_blank">Validator Guide</a></li> <li><a href="https://github.com/terra-money/validator-profiles" target="_blank">Profiles</a></li> <li><a href="https://discord.gg/ZHBuKda" target="_blank">Discord Channel</a></li></ul></div> <div class="sns-container"><div class="logos"><a href="https://discord.gg/e29HWwC2Mz" rel="noopener" target="_blank"><img src="/img/discord.svg" alt="link to Terra discord room"></a> <a href="https://medium.com/terra-money" rel="noopener" target="_blank"><img src="/img/medium.svg" alt="link to Terra medium"></a> <a href="https://twitter.com/terra_money" rel="noopener" target="_blank"><img src="/img/twitter.svg" alt="link to Terra twitter"></a> <a href="https://www.youtube.com/channel/UCoV1RXZ9ZBGcuu_PMTTlM0g" rel="noopener" target="_blank"><img src="/img/icon_youtube.png" alt="link to Terra youtube"></a> <a href="https://t.me/terra_announcements" rel="noopener" target="_blank"><img src="/img/icon_telegram.png" alt="link to Terra telegram room"></a></div> <a href="https://www.terra.money" target="_blank" class="terramoney">terra.money</a></div></div></main></div><div class="global-ui"><div class="darkmode-switch"><div class="item day active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M512 256a42.666667 42.666667 0 0 0 42.666667-42.666667V128a42.666667 42.666667 0 0 0-85.333334 0v85.333333a42.666667 42.666667 0 0 0 42.666667 42.666667zM896 469.333333h-85.333333a42.666667 42.666667 0 0 0 0 85.333334h85.333333a42.666667 42.666667 0 0 0 0-85.333334zM256 512a42.666667 42.666667 0 0 0-42.666667-42.666667H128a42.666667 42.666667 0 0 0 0 85.333334h85.333333a42.666667 42.666667 0 0 0 42.666667-42.666667zM265.386667 213.333333a42.666667 42.666667 0 0 0-59.306667 62.72l61.44 59.306667a42.666667 42.666667 0 0 0 31.146667 11.946667 42.666667 42.666667 0 0 0 30.72-13.226667 42.666667 42.666667 0 0 0 0-60.16zM725.333333 347.306667a42.666667 42.666667 0 0 0 29.44-11.946667l61.44-59.306667A42.666667 42.666667 0 0 0 758.613333 213.333333l-61.44 60.586667a42.666667 42.666667 0 0 0 0 60.16 42.666667 42.666667 0 0 0 28.16 13.226667zM512 768a42.666667 42.666667 0 0 0-42.666667 42.666667v85.333333a42.666667 42.666667 0 0 0 85.333334 0v-85.333333a42.666667 42.666667 0 0 0-42.666667-42.666667zM756.48 688.64a42.666667 42.666667 0 0 0-59.306667 61.44L758.613333 810.666667a42.666667 42.666667 0 0 0 29.44 11.946666 42.666667 42.666667 0 0 0 30.72-12.8 42.666667 42.666667 0 0 0 0-60.586666zM267.52 688.64l-61.44 59.306667a42.666667 42.666667 0 0 0 0 60.586666 42.666667 42.666667 0 0 0 30.72 12.8 42.666667 42.666667 0 0 0 28.586667-10.666666l61.44-59.306667a42.666667 42.666667 0 0 0-59.306667-61.44zM512 341.333333a170.666667 170.666667 0 1 0 170.666667 170.666667 170.666667 170.666667 0 0 0-170.666667-170.666667z"></path></svg></div> <div class="item auto"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M460.864 539.072h103.936l-54.208-163.072-49.728 163.072z m411.136-176.704V149.504h-212.352L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352v-212.928l149.12-149.504-149.184-149.504zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624H320.768l144.576-407.68h90.368l144.576 407.68H614.464z m0 0"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M935.538601 630.40178c-11.43005-11.432249-28.673759-14.738607-43.531086-8.353536-46.733115 20.10317-96.362866 30.296859-147.50719 30.296859-99.589478 0-193.221796-38.783705-263.640252-109.20316-108.636744-108.636744-139.609745-270.022125-78.9083-411.148441 6.388069-14.85233 3.078713-32.098837-8.353536-43.532285-11.432249-11.432249-28.675758-14.743604-43.532285-8.354536-52.637312 22.64025-100.017388 54.809439-140.82552 95.616372-85.346135 85.346135-132.346869 198.821199-132.346869 319.519766 0 120.699566 47.001733 234.172631 132.347868 319.518766s198.821199 132.349067 319.517567 132.349067c120.699566 0 234.172431-47.002932 319.520765-132.351066 40.808132-40.810131 72.977122-88.190207 95.615373-140.82552C950.282205 659.081735 946.971849 641.834029 935.538601 630.40178z" p-id="3638"></path></svg></div></div></div></div>
    <script src="/assets/js/app.5daa07b7.js" defer></script><script src="/assets/js/3.bd3f871b.js" defer></script><script src="/assets/js/94.abfbf92f.js" defer></script>
  </body>
</html>
